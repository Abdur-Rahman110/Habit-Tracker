<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker</title>
    <link rel="icon" type="image/x-icon" href="../OIP.png" />
  </head>
  <body>
    <h1 id="title">Month</h1>
    <h2 id="subtitle">Monthly Habit Tracker</h2>
    <div id="calendarContainer">
        <div id="calendarDiv">
            <div id="calendarHeading">
                <p id="habitTitle">My New Habit</p>
                <p id="totalDays">0/31</p>
                <p id="streak">Current Streak: 0 days</p>
            </div>
            <div id="calendarContent">
              <div id="tracker">
                <div class="days">
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                </div>
                <div class="days">
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                </div>
                <div class="days">
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                </div>
                <div class="days">
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                </div>
                <div class="days">
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                    <div class="day">1</div>
                </div>
              </div>    
            </div>
        </div>
    </div>

    <button id="resetButton">Reset Button</button>
</body>
<style>
    body{
        background-image: url("oip.jpg");
        background-size: 500px;
        text-align: center;
    }
    #title{
        margin-top: 100px;
        line-height: 10px;

    }
    #subtitle{
        opacity: 0.7;
        font-size: 18px;
        margin-bottom: 20px;
    }
    #calendarContainer{
        display:flex;
        justify-content: center;
    }
    #calendarDiv {
        background-color: rgb(255,255,255);
        border-radius: 10px 10px 20px 20px;
        align-items: center ;
        text-align: center;
    }
    #calendarHeading {
        display: flex;
        justify-content: space-between;
        border-radius: 10px 10px 0px 0px;
        border: 2px solid black;
        padding: 0px 20px;
        font-size: 20px;
        background-color: aqua;
        line-height: 0px;
    }
    #calendarContent {
        padding: 20px;
        border: 2px solid black;
    }
    .days{
        display:flex;

    }
    .day{
        width: 30px;
        margin:3px;
        padding: 10px;
        font-size: 15px;
        text-align:center;
        border-radius: 20px;
    }
 </style>
 <script>
    var date= new Date();
    console.log(date);

    var currentMonth= date.getMonth();
    var currentDay = date.getDay();
    var currentDate = date.getDate();
    var currentYear = date.getFullYear();

    console.log(" The current month is " + currentMonth);
    console.log("The current weekday is " + currentDay);
    console.log("The current date is" + currentDate);
    console.log("The current year is" + currentYear);

    var months = [
        "January" ,
        "February" ,
        "March" ,
        "April" ,
        "May" ,
        "June" ,
        "July" ,
        "August" ,
        "September" ,
        "October" ,
        "November" ,
        "December" ,
    ];
    var title= document.getElementById("title");
    title.innerHTML = months[currentMonth];

    var habitTitle = document.getElementById("habitTitle");
    habitTitle.onclick = function() {
        let habits = prompt("Whats your habit", habitTitle.innerHTML);
        if(habits === null) return;
        if(habits.length == 0 ){
            habitTitle.innerHTML = "Click to set your habit";
        }
        else{
            habitTitle.innerHTML = habits;
        }
    }
        
    var daysInTheMonthList = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30 , 31];
    var daysInThisMonth = daysInTheMonthList[currentMonth];

    var daysCompleted = 0;
    var totalDays = document.getElementById("totalDays");

    var daycount = 0;
    var days = document.getElementsByClassName("days");

    for(var i=0; i < days.length; i++){
        var day = days[i].getElementsByClassName("day");
        for( var j=0; j < day.length; j++){
            if(daycount == currentDate - 1){
                day[j].setAttribute("style", "color:rgb(234,1,144); border:2px solid black");
            }
            if (daycount < daysInThisMonth) {
                day[j].innerHTML = daycount + 1;
                day[j].setAttribute("id", "day" + (daycount + 1));
                daycount++;
            } else {
                day[j].innerHTML = "";
                day[j].setAttribute("style", "background-color:white");
            }
        }
    }
    for (var i=0; i < daycount; i++) {
        var tempString = ""+ (currentMonth + 1) + "-" + (i+1) + "-" + currentYear;
        console.log("storing date:" + tempString);
        var tempday = localStorage.getItem(tempString);
        console.log(tempday);
        if(tempday == null || tempday == "false" ){
            localStorage.setItem(tempString, "false");
        } else if (tempday == "true" ) {
            daysCompleted++;
        }
        totalDays.innerHTML = daysCompleted + "/" + daysInThisMonth;
    }
    var streak = 0;
    var streakElement = document.getElementById("streak");

    for (var i = currentDate; i >= 1; i--) {
        var checkDay = "" + (currentMonth + 1) + "-" + i + "-" + currentYear;
        var dayStatus = localStorage.getItem(checkDay);
        if (dayStatus === "true"){
            streak++;
        } else {
            break;
        }
    }
    streakElement.innerHTML = "Current Streak: " + streak + " days";
    console.log("total days completed:" + daysCompleted);
    
    for (var i = 0; i < currentDate; i++) {
        var tempstring = ""+ (currentMonth + 1) + "-" + (i+1) + "-" + currentYear;
        console.log(tempstring);

        var chosenDay = localStorage.getItem(tempstring);
        console.log(i + 1 + ": " + chosenDay);
        
        var chosenDayDiv = document.getElementById("day"+ (i+1));
        if (chosenDay === "true" ) {
            chosenDayDiv.style.backgroundColor = "aqua";
        } else if (chosenDay === "false") {
            chosenDayDiv.style.backgroundColor = "white";
        }
    }
    
    var dayDivs = document.querySelectorAll(".day");
    for (var i=0; i<currentDate;i++){
        dayDivs[i].onclick = function (e) {
            var num = e.target.innerText;
            var selectedDate = document.getElementById(e.target.id);
            var storageString = "" + (currentMonth + 1) + "-" + num + "-" + currentYear;
            if(localStorage.getItem(storageString) === "false"){
                selectedDate.style.backgroundColor = "aqua";
                localStorage.setItem(storageString, "true");
                daysCompleted++;
            }else if(localStorage.getItem(storageString) === "true"){
                selectedDate.style.backgroundColor = "white";
                localStorage.setItem(storageString, "false");
                daysCompleted--;
            }
            totalDays.innerHTML = daysCompleted + "/" + daysInThisMonth;
            updateStreak();
            console.log(daysCompleted, currentDate);
            if(daysCompleted === currentDate){
                alert("great progress");
            }
        }
    }
    
    var resetButton = document.getElementById("resetButton");
    resetButton.onclick = function () {
        for (var i = 0; i < daycount; i++) {
            var tempStrings = "" + (currentMonth+1) + "-" + (i+1) + "-" + currentYear;
            console.log(tempStrings);
            localStorage.setItem(tempStrings, "false");
            var curDay = document.getElementById("day"+(i+1));
            curDay.style.backgroundColor = "white";
        }
        daysCompleted = 0;
        totalDays.innerHTML = daysCompleted + "/" + daysInThisMonth;
        streak= 0;
        streakElement.innerHTML = "Current Streak: 0 days";
    }; 
        function updateStreak() {
            streak = 0;
            for (var i = currentDate;i >=1; i--) {
                var checkDay = "" +  (currentMonth + 1) + "-"  + i + "-" + currentYear;
                var dayStatus = localStorage.getItem(checkDay);
                if (dayStatus === "true") {
                    streak++
                } else{
                    break;
                }
            }
            streakElement.innerHTML = "Current Streak: " + streak + " days";
        }
 </script>
</html>
